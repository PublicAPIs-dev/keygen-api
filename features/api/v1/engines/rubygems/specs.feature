@api/v1
Feature: Rubygems quick gemspec
  Background:
    Given the following "accounts" exist:
      | id                                   | slug  | name   |
      | 14c038fd-b57e-432d-8c09-f50ebcd6a7bc | test1 | Test 1 |
      | b8cd8416-6dfb-44dd-9b69-1d73ee65baed | test2 | Test 2 |
    And the current account is "test1"
    And the current account has the following "product" rows:
      | id                                   | name   | distribution_strategy |
      | 6198261a-48b5-4445-a045-9fed4afc7735 | Test 1 | LICENSED              |
      | cad3c65c-b6a5-4b3d-bce6-c2280953b8b8 | Test 2 | LICENSED              |
    And the current account has the following "package" rows:
      | id                                   | product_id                           | engine   | key  |
      | 46e034fe-2312-40f8-bbeb-7d9957fb6fcf | 6198261a-48b5-4445-a045-9fed4afc7735 | rubygems | foo  |
      | 2f8af04a-2424-4ca2-8480-6efe24318d1a | 6198261a-48b5-4445-a045-9fed4afc7735 | rubygems | bar  |
      | 7b113ac2-ae81-406a-b44e-f356126e2faa | cad3c65c-b6a5-4b3d-bce6-c2280953b8b8 | rubygems | baz  |
      | cd46b4d3-60ab-43e9-b19d-87a9faf13adc | cad3c65c-b6a5-4b3d-bce6-c2280953b8b8 | rubygems | qux  |
      | 5666d47e-936e-4d48-8dd7-382d32462b4e | 6198261a-48b5-4445-a045-9fed4afc7735 | raw      | quxx |
    And the current account has the following "release" rows:
      | id                                   | product_id                           | release_package_id                   | version      | channel  | status    |
      | 757e0a41-835e-42ad-bad8-84cabd29c72a | 6198261a-48b5-4445-a045-9fed4afc7735 | 46e034fe-2312-40f8-bbeb-7d9957fb6fcf | 1.0.0        | stable   | PUBLISHED |
      | 3ff04fc6-9f10-4b84-b548-eb40f92ea331 | 6198261a-48b5-4445-a045-9fed4afc7735 | 46e034fe-2312-40f8-bbeb-7d9957fb6fcf | 1.0.1        | stable   | PUBLISHED |
      | 028a38a2-0d17-4871-acb8-c5e6f040fc12 | 6198261a-48b5-4445-a045-9fed4afc7735 | 46e034fe-2312-40f8-bbeb-7d9957fb6fcf | 1.1.0        | stable   | PUBLISHED |
      | 972aa5b8-b12c-49f4-8ba4-7c9ae053dfa2 | 6198261a-48b5-4445-a045-9fed4afc7735 | 2f8af04a-2424-4ca2-8480-6efe24318d1a | 1.0.0-beta.1 | beta     | PUBLISHED |
      | f36515f2-e907-40a3-ac81-2cc1042f8ec9 | 6198261a-48b5-4445-a045-9fed4afc7735 | 2f8af04a-2424-4ca2-8480-6efe24318d1a | 1.0.0-beta.2 | beta     | PUBLISHED |
      | 56f66b77-f447-4300-828b-5cf92e457376 | 6198261a-48b5-4445-a045-9fed4afc7735 | 2f8af04a-2424-4ca2-8480-6efe24318d1a | 1.0.0-beta.3 | beta     | DRAFT     |
      | 0b5bb946-7346-448b-90a0-e8bbc02570e2 | cad3c65c-b6a5-4b3d-bce6-c2280953b8b8 | 7b113ac2-ae81-406a-b44e-f356126e2faa | 1.0.0        | stable   | YANKED    |
      | 28a6e16d-c2a6-4be7-8578-e236182ee5c3 | cad3c65c-b6a5-4b3d-bce6-c2280953b8b8 | 7b113ac2-ae81-406a-b44e-f356126e2faa | 2.0.0        | stable   | PUBLISHED |
      | 00c9c981-8a75-494b-9207-71a829665729 | cad3c65c-b6a5-4b3d-bce6-c2280953b8b8 | cd46b4d3-60ab-43e9-b19d-87a9faf13adc | 1.0.0        | stable   | PUBLISHED |
      | e00475de-edcc-4571-adec-5ef1b91ddb85 | cad3c65c-b6a5-4b3d-bce6-c2280953b8b8 | cd46b4d3-60ab-43e9-b19d-87a9faf13adc | 1.1.0        | stable   | PUBLISHED |
      | d1bb5fca-0afc-4464-b321-4bd45cca8c7a | 6198261a-48b5-4445-a045-9fed4afc7735 | 5666d47e-936e-4d48-8dd7-382d32462b4e | 1.0.0        | stable   | PUBLISHED |
      | 70c40946-4b23-408c-aa1c-fa35421ff46a | 6198261a-48b5-4445-a045-9fed4afc7735 | 5666d47e-936e-4d48-8dd7-382d32462b4e | 1.1.0        | stable   | PUBLISHED |
      | 04d3d9da-4e91-4634-9aa0-41e39a23658c | 6198261a-48b5-4445-a045-9fed4afc7735 |                                      | 0.0.1        | stable   | PUBLISHED |
    And the current account has the following "artifact" rows:
      | id                                   | release_id                           | filename             | filetype | platform | checksum                                                                                                                         | status   |
      | 5762c549-7f5b-4a73-9873-3acdb1213fe8 | 757e0a41-835e-42ad-bad8-84cabd29c72a | foo-1.0.0.gem        | gem      | ruby     | 52ab51053cfd7ce4b831cbf035951a1f25442360c1f17cf17c22ae09cbbe8c6e0b1acf2670f5e8816838b4e6f8ccbfbb64e647ee0452ec463ac49118d4c776f0 | UPLOADED |
      | ec49b6bd-a73a-47a3-bd05-f0ecab3b90c0 | 3ff04fc6-9f10-4b84-b548-eb40f92ea331 | foo-1.0.1.gem        | gem      | ruby     | a4cd4c2b4f87c4f5638f20f5d3a7adbe401a99fc83d4a5f8eb33f1ee9fa7d533f45df84d17c9c258b4033324428be6a0df0be9f98c2ba09b427aa72b6cd1f8a5 | UPLOADED |
      | 92c38af8-7ed7-4adc-aee2-21ceb5c6511c | 028a38a2-0d17-4871-acb8-c5e6f040fc12 | foo-1.1.0-jruby.gem  | gem      | jruby    | b69abdfd1fdf7ef65eeabde6599ee704c5911ac502a1bf5f4befc679972d58748951449f2818a5f0109009ac2d828c8e6115d76d3c5cfba0281c7660aa6dce78 | UPLOADED |
      | 55bba4f4-6494-4a2d-a14e-6b4d6d2d00e8 | 028a38a2-0d17-4871-acb8-c5e6f040fc12 | foo-1.1.0.gem        | gem      | ruby     | 81c57f95412fe5b2825a0636761d818605600b0afb71f32230cf37768b4fd11357b426364ff155293a0551919569c75c376c16d6b986dc8fdbd9e02065b5eebf | UPLOADED |
      | 346bd7fd-79fa-4ede-ac55-3ea07ed4cab2 | 972aa5b8-b12c-49f4-8ba4-7c9ae053dfa2 | bar-1.0.0-beta.1.gem | gem      |          | 270d937e5b0c03e141e83160edc595830e3adfe70b611db31e16a40993b485b74477e66b5b46906c8b8bebc4be27026580ebc75eb71070cc501392e1135ae318 | UPLOADED |
      | c8aa34a7-3925-479b-9785-ada9a3736867 | f36515f2-e907-40a3-ac81-2cc1042f8ec9 | bar-1.0.0-beta.2.gem | gem      |          | 96337edc760ec8f29dab326f3498d6d260798efd5699fb818ea47ea76a3589fc5b5726666a3702927ee026451840bf8bfe4d4f881b60433e6ff3ee5fa3e69bfd | UPLOADED |
      | b95ec07b-1210-4ddc-920e-6008a5c8ed3c | 56f66b77-f447-4300-828b-5cf92e457376 | bar-1.0.0-beta.3.gem | gem      |          | 10cf6e6911fc85450768121f7a5d7c5955a6fc9152c59e9053c176d5b3499a12ee2f652a2a491ed876287d3f8d6710d13900c7c7331ea20ff4641643b47ea856 | UPLOADED |
      | 9b0fa689-36c3-4b1f-be82-382238a2c5d0 | 0b5bb946-7346-448b-90a0-e8bbc02570e2 | baz-1.0.0.gem        | gem      |          | dfd57f7723abdd49c19929e254cbde4d80c2bdd89cc7733a2b1c5d46dec2003c420437506c3436c838aad109160c1678d4d2ef7ed3477c8183a1269672261b46 | UPLOADED |
      | b6049631-dac8-49b6-a923-78f022cb1dbe | 28a6e16d-c2a6-4be7-8578-e236182ee5c3 | baz-2.0.0.gem        | gem      |          | dfd57f7723abdd49c19929e254cbde4d80c2bdd89cc7733a2b1c5d46dec2003c420437506c3436c838aad109160c1678d4d2ef7ed3477c8183a1269672261b46 | UPLOADED |
      | df4474cb-2a7b-4f75-8f27-2b99320e0164 | 00c9c981-8a75-494b-9207-71a829665729 | qux-1.0.0.gem        | gem      |          | 8c9e896fd71db779dfa414be3afcef9e45afb50f6c5e9e88e7daa394d2a8cc2b8b77d27e114cc6eccdf317e4532882c586a33cc6d3dd15123d639788e8948257 | UPLOADED |
      | f52378c0-1d1c-45f6-bff3-3231a99dfb27 | e00475de-edcc-4571-adec-5ef1b91ddb85 | qux-1.0.1.gem        | gem      | ruby     |                                                                                                                                  | WAITING  |
      | e7c08c5d-0e1a-439f-8730-3cc5ed8399b9 | d1bb5fca-0afc-4464-b321-4bd45cca8c7a | quxx-1.0.0.gem       | gem      | ruby     | f976fe01f8bb9c192e39b3ee37f84c16c52b3868b3f635c809bf70707bc120bc699e3d385085b5fb84f45456a108fa863ca03016075dbec34a530deb01d8c964 | FAILED   |
      | 5acc0c22-0b7e-43f5-8168-8d341cccbaa6 | 70c40946-4b23-408c-aa1c-fa35421ff46a | quxx-1.1.0.gem       | gem      | ruby     | ee5ce16c849ef08f71464e806abcd95b77d2a98599fefe1863e3321e4eca941966ba07ef1e7cca0f2e2f60fccac6bd0ba407f8b105b0b5590ecc2f2f1e5a10d5 | UPLOADED |
      | 22af171a-be06-47b1-bec3-3b2f8974990a | 04d3d9da-4e91-4634-9aa0-41e39a23658c | corge-1.1.0.gem      | gem      |          |                                                                                                                                  | UPLOADED |
    And the current account has the following "spec" rows:
      | release_artifact_id                  | release_id                           | content                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
      | 5762c549-7f5b-4a73-9873-3acdb1213fe8 | 757e0a41-835e-42ad-bad8-84cabd29c72a | --- !ruby/object:Gem::Specification\nname: foo\nversion: !ruby/object:Gem::Version\n  version: 1.0.0\nplatform: ruby\nauthors: []\nautorequire: \nbindir: bin\ncert_chain: []\ndate: 2024-10-22 00:00:00.000000000 Z\ndependencies:\n- !ruby/object:Gem::Dependency\n  name: rails\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '7.0'\n  type: :runtime\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '7.0'\n- !ruby/object:Gem::Dependency\n  name: rspec-rails\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n- !ruby/object:Gem::Dependency\n  name: temporary_tables\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n- !ruby/object:Gem::Dependency\n  name: sql_matchers\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n- !ruby/object:Gem::Dependency\n  name: sqlite3\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.4'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.4'\n- !ruby/object:Gem::Dependency\n  name: mysql2\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n- !ruby/object:Gem::Dependency\n  name: pg\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\ndescription: foo\nemail: \nexecutables: []\nextensions: []\nextra_rdoc_files: []\nfiles: []\nhomepage: \nlicenses:\n- MIT\nmetadata: {}\npost_install_message: \nrdoc_options: []\nrequire_paths:\n- lib\nrequired_ruby_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '3.1'\nrequired_rubygems_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequirements: []\nrubygems_version: 3.5.11\nsigning_key: \nspecification_version: 4\nsummary: \ntest_files: []\n  |
      | ec49b6bd-a73a-47a3-bd05-f0ecab3b90c0 | 3ff04fc6-9f10-4b84-b548-eb40f92ea331 | --- !ruby/object:Gem::Specification\nname: foo\nversion: !ruby/object:Gem::Version\n  version: 1.0.1\nplatform: ruby\nauthors: []\nautorequire: \nbindir: bin\ncert_chain: []\ndate: 2024-10-22 00:00:00.000000000 Z\ndependencies:\n- !ruby/object:Gem::Dependency\n  name: rails\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '7.0'\n  type: :runtime\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '7.0'\n- !ruby/object:Gem::Dependency\n  name: rspec-rails\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n- !ruby/object:Gem::Dependency\n  name: temporary_tables\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n- !ruby/object:Gem::Dependency\n  name: sql_matchers\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n- !ruby/object:Gem::Dependency\n  name: sqlite3\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.4'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.4'\n- !ruby/object:Gem::Dependency\n  name: mysql2\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n- !ruby/object:Gem::Dependency\n  name: pg\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\ndescription: foo\nemail: \nexecutables: []\nextensions: []\nextra_rdoc_files: []\nfiles: []\nhomepage: \nlicenses:\n- MIT\nmetadata: {}\npost_install_message: \nrdoc_options: []\nrequire_paths:\n- lib\nrequired_ruby_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '3.1'\nrequired_rubygems_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequirements: []\nrubygems_version: 3.5.11\nsigning_key: \nspecification_version: 4\nsummary: \ntest_files: []\n  |
      | 92c38af8-7ed7-4adc-aee2-21ceb5c6511c | 028a38a2-0d17-4871-acb8-c5e6f040fc12 | --- !ruby/object:Gem::Specification\nname: foo\nversion: !ruby/object:Gem::Version\n  version: 1.1.0\nplatform: jruby\nauthors: []\nautorequire: \nbindir: bin\ncert_chain: []\ndate: 2024-10-22 00:00:00.000000000 Z\ndependencies:\n- !ruby/object:Gem::Dependency\n  name: rails\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '7.0'\n  type: :runtime\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '7.0'\n- !ruby/object:Gem::Dependency\n  name: rspec-rails\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n- !ruby/object:Gem::Dependency\n  name: temporary_tables\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n- !ruby/object:Gem::Dependency\n  name: sql_matchers\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n- !ruby/object:Gem::Dependency\n  name: sqlite3\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.4'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.4'\n- !ruby/object:Gem::Dependency\n  name: mysql2\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n- !ruby/object:Gem::Dependency\n  name: pg\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\ndescription: foo\nemail: \nexecutables: []\nextensions: []\nextra_rdoc_files: []\nfiles: []\nhomepage: \nlicenses:\n- MIT\nmetadata: {}\npost_install_message: \nrdoc_options: []\nrequire_paths:\n- lib\nrequired_ruby_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '3.1'\nrequired_rubygems_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequirements: []\nrubygems_version: 3.5.11\nsigning_key: \nspecification_version: 4\nsummary: \ntest_files: []\n |
      | 55bba4f4-6494-4a2d-a14e-6b4d6d2d00e8 | 028a38a2-0d17-4871-acb8-c5e6f040fc12 | --- !ruby/object:Gem::Specification\nname: foo\nversion: !ruby/object:Gem::Version\n  version: 1.1.0\nplatform: ruby\nauthors: []\nautorequire: \nbindir: bin\ncert_chain: []\ndate: 2024-10-22 00:00:00.000000000 Z\ndependencies:\n- !ruby/object:Gem::Dependency\n  name: rails\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '7.0'\n  type: :runtime\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '7.0'\n- !ruby/object:Gem::Dependency\n  name: rspec-rails\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n- !ruby/object:Gem::Dependency\n  name: temporary_tables\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n- !ruby/object:Gem::Dependency\n  name: sql_matchers\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.0'\n- !ruby/object:Gem::Dependency\n  name: sqlite3\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.4'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - "~>"\n      - !ruby/object:Gem::Version\n        version: '1.4'\n- !ruby/object:Gem::Dependency\n  name: mysql2\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n- !ruby/object:Gem::Dependency\n  name: pg\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n  type: :development\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\ndescription: foo\nemail: \nexecutables: []\nextensions: []\nextra_rdoc_files: []\nfiles: []\nhomepage: \nlicenses:\n- MIT\nmetadata: {}\npost_install_message: \nrdoc_options: []\nrequire_paths:\n- lib\nrequired_ruby_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '3.1'\nrequired_rubygems_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequirements: []\nrubygems_version: 3.5.11\nsigning_key: \nspecification_version: 4\nsummary: \ntest_files: []\n  |
      | 346bd7fd-79fa-4ede-ac55-3ea07ed4cab2 | 972aa5b8-b12c-49f4-8ba4-7c9ae053dfa2 | --- !ruby/object:Gem::Specification\nname: bar\nversion: !ruby/object:Gem::Version\n  version: 1.0.0-beta.1\nplatform: ruby\nauthors: []\nautorequire: \nbindir: bin\ncert_chain: []\ndate: 2024-10-22 00:00:00.000000000 Z\ndependencies: []\ndescription: bar\nemail: \nexecutables: []\nextensions: []\nextra_rdoc_files: []\nfiles: []\nhomepage: \nlicenses: []\nmetadata: {}\npost_install_message: \nrdoc_options: []\nrequire_paths:\n- lib\nrequired_ruby_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequired_rubygems_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequirements: []\nrubygems_version: 3.5.11\nsigning_key: \nspecification_version: 4\nsummary: \ntest_files: []\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
      | c8aa34a7-3925-479b-9785-ada9a3736867 | f36515f2-e907-40a3-ac81-2cc1042f8ec9 | --- !ruby/object:Gem::Specification\nname: bar\nversion: !ruby/object:Gem::Version\n  version: 1.0.0-beta.2\nplatform: ruby\nauthors: []\nautorequire: \nbindir: bin\ncert_chain: []\ndate: 2024-10-22 00:00:00.000000000 Z\ndependencies: []\ndescription: bar\nemail: \nexecutables: []\nextensions: []\nextra_rdoc_files: []\nfiles: []\nhomepage: \nlicenses: []\nmetadata: {}\npost_install_message: \nrdoc_options: []\nrequire_paths:\n- lib\nrequired_ruby_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequired_rubygems_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequirements: []\nrubygems_version: 3.5.11\nsigning_key: \nspecification_version: 4\nsummary: \ntest_files: []\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
      | b95ec07b-1210-4ddc-920e-6008a5c8ed3c | 56f66b77-f447-4300-828b-5cf92e457376 | --- !ruby/object:Gem::Specification\nname: bar\nversion: !ruby/object:Gem::Version\n  version: 1.0.0-beta.3\nplatform: ruby\nauthors: []\nautorequire: \nbindir: bin\ncert_chain: []\ndate: 2024-10-22 00:00:00.000000000 Z\ndependencies: []\ndescription: bar\nemail: \nexecutables: []\nextensions: []\nextra_rdoc_files: []\nfiles: []\nhomepage: \nlicenses: []\nmetadata: {}\npost_install_message: \nrdoc_options: []\nrequire_paths:\n- lib\nrequired_ruby_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequired_rubygems_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequirements: []\nrubygems_version: 3.5.11\nsigning_key: \nspecification_version: 4\nsummary: \ntest_files: []\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
      | 9b0fa689-36c3-4b1f-be82-382238a2c5d0 | 0b5bb946-7346-448b-90a0-e8bbc02570e2 | --- !ruby/object:Gem::Specification\nname: baz\nversion: !ruby/object:Gem::Version\n  version: 1.0.0\nplatform: ruby\nauthors: []\nautorequire: \nbindir: bin\ncert_chain: []\ndate: 2024-10-22 00:00:00.000000000 Z\ndependencies: []\ndescription: baz\nemail: \nexecutables: []\nextensions: []\nextra_rdoc_files: []\nfiles: []\nhomepage: \nlicenses: []\nmetadata: {}\npost_install_message: \nrdoc_options: []\nrequire_paths:\n- lib\nrequired_ruby_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequired_rubygems_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequirements: []\nrubygems_version: 3.5.11\nsigning_key: \nspecification_version: 4\nsummary: \ntest_files: []\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
      | b6049631-dac8-49b6-a923-78f022cb1dbe | 28a6e16d-c2a6-4be7-8578-e236182ee5c3 | --- !ruby/object:Gem::Specification\nname: baz\nversion: !ruby/object:Gem::Version\n  version: 2.0.0\nplatform: ruby\nauthors: []\nautorequire: \nbindir: bin\ncert_chain: []\ndate: 2024-10-22 00:00:00.000000000 Z\ndependencies:\n- !ruby/object:Gem::Dependency\n  name: rack\n  requirement: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\n  type: :runtime\n  prerelease: false\n  version_requirements: !ruby/object:Gem::Requirement\n    requirements:\n    - - ">="\n      - !ruby/object:Gem::Version\n        version: '0'\ndescription: baz\nemail: \nexecutables: []\nextensions: []\nextra_rdoc_files: []\nfiles: []\nhomepage: \nlicenses: []\nmetadata: {}\npost_install_message: \nrdoc_options: []\nrequire_paths:\n- lib\nrequired_ruby_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequired_rubygems_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequirements: []\nrubygems_version: 3.5.11\nsigning_key: \nspecification_version: 4\nsummary: \ntest_files: []\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
      | 5acc0c22-0b7e-43f5-8168-8d341cccbaa6 | 70c40946-4b23-408c-aa1c-fa35421ff46a | --- !ruby/object:Gem::Specification\nname: quxx\nversion: !ruby/object:Gem::Version\n  version: 1.1.0\nplatform: ruby\nauthors: []\nautorequire: \nbindir: bin\ncert_chain: []\ndate: 2024-10-22 00:00:00.000000000 Z\ndependencies: []\ndescription: quxx\nemail: \nexecutables: []\nextensions: []\nextra_rdoc_files: []\nfiles: []\nhomepage: \nlicenses: []\nmetadata: {}\npost_install_message: \nrdoc_options: []\nrequire_paths:\n- lib\nrequired_ruby_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequired_rubygems_version: !ruby/object:Gem::Requirement\n  requirements:\n  - - ">="\n    - !ruby/object:Gem::Version\n      version: '0'\nrequirements: []\nrubygems_version: 3.5.11\nsigning_key: \nspecification_version: 4\nsummary: \ntest_files: []\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
    And I send the following raw headers:
      """
      User-Agent: Ruby, RubyGems/3.5.11 x86_64-linux Ruby/3.3.4 (2024-07-09 patchlevel 94)
      Accept: application/octet-stream
      """

  Scenario: Endpoint should be inaccessible when account is disabled
    Given the account "test1" is canceled
    And I am an admin of account "test1"
    And I use an authentication token
    When I send a GET request to "/accounts/test1/engines/rubygems/quick/Marshal.4.8/foo-1.0.0.gemspec.rz"
    Then the response status should be "403"
    And the response should contain the following headers:
      """
      { "Content-Type": "application/json; charset=utf-8" }
      """

  Scenario: Endpoint should return a quick gemspec
    Given I am an admin of account "test1"
    And I use an authentication token
    When I send a GET request to "/accounts/test1/engines/rubygems/quick/Marshal.4.8/foo-1.0.0.gemspec.rz"
    Then the response status should be "200"
    And the response should contain the following headers:
      """
      { "Content-Type": "application/octet-stream" }
      """
    And the response body should be a gemspec with the following content:
      """
      # -*- encoding: utf-8 -*-
      # stub: foo 1.0.0 ruby lib

      Gem::Specification.new do |s|
        s.name = "foo".freeze
        s.version = "1.0.0".freeze

        s.required_rubygems_version = Gem::Requirement.new(">= 0".freeze) if s.respond_to? :required_rubygems_version=
        s.require_paths = ["lib".freeze]
        s.date = "2024-10-22"
        s.description = "foo".freeze
        s.required_ruby_version = Gem::Requirement.new(">= 3.1".freeze)
        s.rubygems_version = "3.5.11".freeze
        s.summary = nil

        s.specification_version = 4

        s.add_runtime_dependency(%q<rails>.freeze, [">= 7.0".freeze])
        s.add_development_dependency(%q<rspec-rails>.freeze, [">= 0".freeze])
        s.add_development_dependency(%q<temporary_tables>.freeze, ["~> 1.0".freeze])
        s.add_development_dependency(%q<sql_matchers>.freeze, ["~> 1.0".freeze])
        s.add_development_dependency(%q<sqlite3>.freeze, ["~> 1.4".freeze])
        s.add_development_dependency(%q<mysql2>.freeze, [">= 0".freeze])
        s.add_development_dependency(%q<pg>.freeze, [">= 0".freeze])
      end
      """
